---
title: '
<img src="logo.png" alt="Logo" width="400px" style="display:block; margin-left:auto; margin-right:0;" />
<br>
Analiza danych - kredyty hipoteczne
'
date: "`r Sys.Date()`"
authors: "Dominika Zapadka, Agata Witkowska, Mariusz Różek, Antoni Tomas"
output:
  rmarkdown::html_document:
    highlight: kate
    toc: true
    toc_float: true
    toc_depth: 2
    number_sections: true
    fig_caption: true
    fig_width: 6
    fig_height: 4
    self_contained: true
    theme: readable
---

```{r setup, include=FALSE}
## Global options
if (!require("naniar")) install.packages("naniar")
if (!require("Amelia")) install.packages("Amelia")
if (!require("mice")) install.packages("mice")
if (!require("finalfit")) install.packages("finalfit")
if(!require("VIM")) install.packages("VIM")
if(!require("validate")) install.packages("validate")
library(finalfit)
library(Amelia)
library(mice)
library(readr)
library(dplyr)
library(naniar)
knitr::opts_chunk$set(echo = FALSE, cache = TRUE)
dane <- read_csv("Hipoteczny.csv")
```
<style>
body {
  background-color: #e6f0ff;
}
</style>

# **Wstęp**

## Opis problemu

Celem projektu jest przeprowadzenie analizy danych dotyczących zatwierdzenia kredytu mieszkaniowego i określenie, które czynniki w największym stopniu wpływają na decyzję o przyznaniu pożyczki. Firma, której dane analizujemy obsługuje klientów z obszarów miejskich, półmiejskich i wiejskich, a proces wnioskowania odbywa się za pomocą wypełnienia formularza online przez klienta. Aby przyspieszyć podejmowanie decyzji i zwiększyć efektywność obsługi, przedsiębiorstwo planuje automatyzację procesu oceny zdolności kredytowej w czasie rzeczywistym.

## Dane

Do analizy wykorzystano zbiór danych: [Hipoteczny.csv](https://github.com/antonitomas/Projekt---kredyty-hipoteczne/blob/main/Hipoteczny.csv){style="color:navy"}.

Obejmuje on 614 obserwacji. Dane pochodzą z procesu składania wniosków kredytowych i zawierają informacje o wnioskodawcy i charakterystyce pożyczki. Wśród dostępnych kolumn znajdują się między innymi:

-   **Loan_ID:** identyfikator wniosku,
-   **Gender:** płeć wnioskodawcy,
-   **Married:** informacja o stanie cywilnym,
-   **Dependents:** liczba osób na utrzymaniu,
-   **Education:** poziom wykształcenia,
-   **Self_Employed:** prowadzenie działalności gospodarczej,
-   **ApplicantIncome i CoapplicantIncome:** dochody głównego i współwnioskodawcy,
-   **LoanAmount:** kwota pożyczki,
-   **Loan_Amount_Term:** okres kredytowania,
-   **Credit_history:** informacja o historii kredytowej,
-   **Property_Area:** obszar pochodzenia klienta,
-   **Loan_Status:** wynik decyzji kredytowej (zatwierdzony lub odrzucony).

Zbiór danych nie jest kompletny i część kolumn zawiera braki. Najwięcej braków występuje w zmiennych **Credit_History, LoanAmount, Loan_Amount_Term, Self_Employed, Dependents** oraz częściowo w **Gender** i **Married**. Wstępny przegląd danych pokazuje, że tylko zmienne takie jak dochód czy identyfikator wniosku są pełne, a elementy oceny ryzyka kredytowego wymagają dalszego uzupełnienia.

## Przebieg analizy

Projekt koncentruje się na zrozumieniu, które cechy klientów najsilniej wiążą się z przyznaniem lub odrzuceniem kredytu i przygotowaniu modelu, który mógłby automatycznie wskazywać potencjalnie kwalifikujących się wnioskdawców. Wykonamy wstępne oczyszczanie danych, eksplorację, wizualizację i przeprowadzimy analizę jedno oraz dwuwymiarową. Wnioski z analizy pomogą usprawnić proces oceny wniosków kredytowych oraz poprawić skuteczność i spójność decyzji podejmowanych przez firmę.

## Braki danych

```{r wczytanie danych, message=FALSE, warning=FALSE, include=FALSE}
kredyty <- as.data.frame(dane)
View(kredyty)
```
Opisać każdy wykres...

```{r podsumowanie braków danych, message=FALSE, warning=FALSE}
miss_var_summary(kredyty)
```
Najwięcej braków jest dla zmiennej Credit_History (50 braków), następnie Self_Employed (32 braki), LoanAmount (22 braki) oraz Dependents (15 braków.
```{r wizualizacja braków danych 1, message=FALSE, warning=FALSE}
gg_miss_fct(kredyty, Dependents)
```

```{r wizualizacja braków danych 2, message=FALSE, warning=FALSE}
gg_miss_upset(kredyty)
```

```{r wizualizacja braków danych 3, message=FALSE, warning=FALSE}
missmap(kredyty)
```
Wykres popa
```{r wizualizacja braków danych 4, message=FALSE, warning=FALSE}
md.pattern(kredyty, rotate.names = TRUE)
```

Dane zawierają 2% braków danych (Missingness Map), a braki ten nie są zależne między sobą (md pattern). W celu zastąpienia braków danych można wykorzystać proste metody: mediana, średnia, dominanta lub użyć funkcji hotdeck.

## Zastępowanie braków danych
Hotdeck - zastępowanie braków danych według wierszy najczęściej się powtarzających (najbardziej prawdopodobny)

```{r zastępowanie braków danych, message=FALSE, warning=FALSE}
library(VIM)
kredyty_inp <- hotdeck(kredyty)
vis_miss(kredyty_inp, sort_miss = TRUE)
```
## Reguły zmiennych
Nadano reguły dla zmiennych w celu sprawdzenia poprawności danych po uzupełnieniu braków.Stworzono wykres, który sprawdza, czy dane spełniają ustalone reguły.
```{r reguły zmiennych}
#ustalanie reguł dla zmiennych
library(validate) 
rules <- validator (
  Dependents >=0,
  Gender %in% c("Male","Female"),
  Married %in% c("Yes","No"),
  Education %in% c("Graduate","Not Graduate"),
  Self_Employed %in% c("Yes","No"),
  Applicantincome >=0,
  Coapplicantincome >=0,
  LoanAmount >=0,
  Loan_Amount_Term >=0,
  Loan_Status %in% c("Y","N"),
  Credit_history %in% c(0,1)
)
cf <- confront(kredyty_inp, rules, key="Loan_ID")
summary(cf)
barplot(cf, main="kredyty_inp")
#as.data.frame(cf) %>% head()
```