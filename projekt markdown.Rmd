---
title: '
<img src="logo.png" alt="Logo" width="400px" style="display:block; margin-left:auto; margin-right:0;" />
<span style="color:navy;">
<br>
Analiza danych - kredyty hipoteczne
</span>
'
date: "`r Sys.Date()`"
authors: "Dominika Zapadka, Agata Witkowska, Mariusz Różek, Antoni Tomas"
output:
  rmarkdown::html_document:
    highlight: kate
    toc: true
    toc_float: true
    toc_depth: 2
    number_sections: true
    fig_caption: true
    fig_width: 6
    fig_height: 4
    self_contained: true
    theme: readable
---

```{r setup, include=FALSE}
## Global options
if (!require("naniar")) install.packages("naniar")
if (!require("Amelia")) install.packages("Amelia")
if (!require("mice")) install.packages("mice")
if (!require("finalfit")) install.packages("finalfit")
if(!require("VIM")) install.packages("VIM")
if(!require("validate")) install.packages("validate")
if(!require("knitr")) install.packages("knitr")
if(!require("kableExtra")) install.packages("kableExtra")
if(!require("ggplot2")) install.packages("ggplot2")
if(!require("patchwork")) install.packages("patchwork")
if(!require("tidyr")) install.packages("tidyr")
if(!require("e1071")) install.packages("e1071")
library(finalfit)
library(Amelia)
library(mice)
library(readr)
library(dplyr)
library(naniar)
library(knitr)
library(kableExtra)
library(ggplot2)
library(patchwork)
library(validate)
library(VIM)
library(tidyr)
library(e1071)
knitr::opts_chunk$set(echo = FALSE, cache = TRUE)
dane <- read_csv("Hipoteczny.csv")
```

```{=html}
<style>
body {
  background-color: #e6f0ff;
}
</style>
```

# **Wstęp**

## Opis problemu

<p style="text-align: justify;">Celem projektu jest przeprowadzenie analizy danych dotyczących zatwierdzenia kredytu mieszkaniowego i określenie, które czynniki w największym stopniu wpływają na decyzję o przyznaniu pożyczki. Firma, której dane analizujemy obsługuje klientów z obszarów miejskich, półmiejskich i wiejskich, a proces wnioskowania odbywa się za pomocą wypełnienia formularza online przez klienta. Aby przyspieszyć podejmowanie decyzji i zwiększyć efektywność obsługi, przedsiębiorstwo planuje automatyzację procesu oceny zdolności kredytowej w czasie rzeczywistym.</p>

## Dane

Do analizy wykorzystano zbiór danych: [Hipoteczny.csv](https://github.com/antonitomas/Projekt---kredyty-hipoteczne/blob/main/Hipoteczny.csv){style="color:navy"}.

<p style="text-align: justify;">Obejmuje on 614 obserwacji. Dane pochodzą z procesu składania wniosków kredytowych i zawierają informacje o wnioskodawcy i charakterystyce pożyczki. Wśród dostępnych kolumn znajdują się między innymi:</p>

-   **Loan_ID:** identyfikator wniosku,
-   **Gender:** płeć wnioskodawcy,
-   **Married:** informacja o stanie cywilnym,
-   **Dependents:** liczba osób na utrzymaniu,
-   **Education:** poziom wykształcenia,
-   **Self_Employed:** prowadzenie działalności gospodarczej,
-   **ApplicantIncome i CoapplicantIncome:** dochody głównego i współwnioskodawcy,
-   **LoanAmount:** kwota pożyczki,
-   **Loan_Amount_Term:** okres kredytowania,
-   **Credit_history:** informacja o historii kredytowej,
-   **Property_Area:** obszar zamieszkania klienta,
-   **Loan_Status:** wynik decyzji kredytowej (zatwierdzony lub odrzucony).

<p style="text-align: justify;">Zbiór danych nie jest kompletny i część kolumn zawiera braki. Najwięcej braków występuje w zmiennych **Credit_History, LoanAmount, Loan_Amount_Term, Self_Employed, Dependents** oraz częściowo w **Gender** i **Married**. Wstępny przegląd danych pokazuje, że tylko zmienne takie jak dochód czy identyfikator wniosku są pełne, a elementy oceny ryzyka kredytowego wymagają dalszego uzupełnienia.</p>

## Przebieg analizy

<p style="text-align: justify;">Projekt koncentruje się na zrozumieniu, które cechy klientów najsilniej wiążą się z przyznaniem lub odrzuceniem kredytu i przygotowaniu modelu, który mógłby automatycznie wskazywać potencjalnie kwalifikujących się wnioskdawców. Wykonamy wstępne oczyszczanie danych, eksplorację, wizualizację i przeprowadzimy analizę jedno oraz dwuwymiarową. Wnioski z analizy pomogą usprawnić proces oceny wniosków kredytowych oraz poprawić skuteczność i spójność decyzji podejmowanych przez firmę.</p>

# **Przygotowanie danych**

## Braki danych

```{r wczytanie danych, message=FALSE, warning=FALSE, include=FALSE}
kredyty <- as.data.frame(dane)
View(kredyty)
```

```{r podsumowanie braków danych, message=FALSE, warning=FALSE}
liczba_brakow <- miss_var_summary(kredyty)
tabela1 <- head(liczba_brakow,3)
colnames(tabela1) <- c("Nazwa zmiennej", "Liczba braków", "Udział braków")

kable(tabela1, align = "c") %>%
  kable_styling(full_width = FALSE, position = "center") %>%
  row_spec(0, bold = TRUE, color = "navy")
```

<p style="text-align: justify;">Największą liczbę brakujących danych zawierają kolejno zmienne: [Credit_History]{style="color:navy;"} (50 braków danych), [Self_Employed]{style="color:navy;"} (32 braki danych) oraz [LoanAmount]{style="color:navy;"} (22 braki danych).</p>

<p style="text-align: center;">[**Braki danych według liczby osób na utrzymaniu**]{style="color:navy;"}</p>

```{r wizualizacja braków danych 1, message=FALSE, warning=FALSE, fig.align='center', fig.width=7, fig.height=5}
gg_miss_fct(kredyty, Dependents) +
  labs(title = "",
       x = "Liczba osób na utrzymaniu",
       y = "Zmienne",
       fill = "Procent braków") +
  theme_minimal(base_size = 14) +
  theme(plot.title = element_text(face = "bold", hjust = 0.5)) +
  scale_fill_gradient(low="lavender", high="navy")
```

<p style="text-align: justify;">Na podstawie heatmapy można stwierdzić nielosowość brakujących danych. Widać to na podstawie dużego natężenia braków danych w zmiennej określającej stan cywilny klienta ([Married]{style="color:navy;"}), w sytuacji gdy nie podał on również liczby osób na swoim utrzymaniu ([Dependents]{style="color:navy;"}).</p>

```{r wizualizacja braków danych 2, message=FALSE, warning=FALSE, include=FALSE}
gg_miss_upset(kredyty)
```

<p style="text-align: center;">[**Mapa braków danych**]{style="color:navy;"}</p>

```{r wizualizacja braków danych 3, message=FALSE, warning=FALSE, fig.align='center', fig.width=7, fig.height=5}
missmap(kredyty,
        main = "",
        col = c("lavender", "midnightblue"))
```

```{r wizualizacja braków danych 4, fig.align='center', fig.height=5, fig.width=7, message=FALSE, warning=FALSE, include=FALSE}
invisible(md.pattern(kredyty, rotate.names = TRUE))
```

<p style="text-align: justify;">Dane zawierają 2% braków danych ([missmap]{style="color:navy;"}), a braki te nie są zależne między sobą ([md.pattern]{style="color:navy;"}). W celu zastąpienia braków danych można wykorzystać proste metody: mediana, średnia, dominanta lub użyć funkcji hotdeck.</p>

## Zastępowanie braków danych

<p style="text-align: justify;">[**Hotdeck**]{style="color:navy;"} - metoda polegająca na zastępowaniu braków danych według wierszy najczęściej się powtarzających (najbardziej prawdopodobnych).</p>

<p style="text-align: justify;">Po zastosowaniu metody hotdeck zbiór danych nie zawiera brakujących wartości. Zostało to pokazane poniżej za pomocą funkcji sumującej wszystkie braki danych w nowym zbiorze.</p>

```{r zastępowanie braków danych, message=FALSE, warning=FALSE}
kredyty_inp <- hotdeck(kredyty)
liczba_brakow <- sum(is.na(kredyty_inp))
udzial_brakow <- round(liczba_brakow / length(kredyty_inp) * 100, 2)
tabela2 <- matrix(
  c(liczba_brakow, paste0(udzial_brakow, "%")),
  nrow = 1
)
colnames(tabela2) <- c("Liczba braków","Udział braków")

kable(tabela2, align = "c") %>%
  kable_styling(full_width = FALSE, position = "center") %>%
  row_spec(0, bold = TRUE, color = "navy")
```

## Reguły zmiennych

<p style="text-align: justify;">W kolejnym etapie nadano reguły dla zmiennych w celu sprawdzenia poprawności danych po uzupełnieniu braków. Poniżej w tabeli przedstawiono ilość wierszy spełniających i niespełniających poszczególne reguły. Widać w niej, że zbiór danych całkowicie spełnia ustalone reguły.</p>

```{r reguły zmiennych, fig.align='center', fig.width=7, fig.height=5}
rules <- validator (
  Dependents >=0,
  Gender %in% c("Male","Female"),
  Married %in% c("Yes","No"),
  Education %in% c("Graduate","Not Graduate"),
  Self_Employed %in% c("Yes","No"),
  ApplicantIncome >=0,
  CoapplicantIncome >=0,
  LoanAmount >=0,
  Loan_Amount_Term >=0,
  Loan_Amount_Term %% 6 == 0,
  Property_Area %in% c("Urban","Semiurban","Rural"),
  Loan_Status %in% c("Y","N"),
  Credit_History %in% c(0,1)
)
cf <- confront(kredyty_inp, rules, key="Loan_ID")
summary_df <- as.data.frame(summary(cf))
summary_df <- summary_df[, c("name", "passes", "fails")]
colnames(summary_df) <- c("Nazwa", "Spełnione", "Niespełnione")
summary_df$Reguła <- c("Liczba osóba na utrzymaniu musi być większa lub równa 0", 
                       "Płeć przyjmuje tylko wartości Male/Female", 
                       "Status cywilny przyjmuje tylko wartości Yes/No", 
                       "Wykształcenie przyjmuje tylko wartości Graduate/Not Graduate", 
                       "Samozatrudnienie przyjmuje tylko wartości Yes/No", 
                       "Dochód wnioskodawcy musi być większy lub równy 0", 
                       "Dochód współwnioskodawcy musi być większy lub równy 0", 
                       "Kwota pożyczki musi być większa lub równa 0", 
                       "Okres kredytowania musi być większy lub równy 0", 
                       "Okres kredytowania musi być podzielny bez reszty przez 6",
                       "Miejsce zamieszkania przyjmuje tylko wartości Urban/Semiurban/Rural", 
                       "Status wniosku przyjmuje tylko wartości Y/N", 
                       "Historia kredytowa przyjmuje tylko wartości 0 lub 1")
kable(summary_df, align = c("c","c","c","l")) %>%
  kable_styling(full_width = FALSE, position = "center") %>%
  row_spec(0, bold = TRUE, color = "navy")
```

<p style="text-align: justify;">W celu potwierdzenia utworzono wykres, który również sprawdza, czy dane spełniają ustalone reguły.</p>

<p style="text-align: center;">[**Wykres spełnienia reguł**]{style="color:navy;"}</p>

```{r reguły zmiennych 2, fig.align='center', fig.width=7, fig.height=5}
df <- as.data.frame(cf)
ggplot(df, aes(y = name, fill = factor(value))) +
  geom_bar(position = "stack") +
  scale_fill_manual(
    values = c("TRUE" = "navy", "FALSE" = "orchid", "NA" = "lavender"),
    labels = c("TRUE" = "Spełnione", "FALSE" = "Niespełnione", "NA" = "Braki danych")
  ) +
  labs(
    y = "Reguła",
    x = "Liczba rekordów",
    fill = "Status"
  ) +
  theme_minimal() +
  theme(
    axis.title.y = element_text(margin = margin(r = 10))
  )
```

## Duplikaty

<p style="text-align: justify;">Dane nie posiadają duplikatów, obserwacje są unikalne i nie ma potrzeby dodatkowego czyszczenia pod kątem prawidłowości struktury danych.</p>

```{r}
liczba_duplikatow <- sum(duplicated(kredyty_inp))
udzial_duplikatow <- round(liczba_duplikatow / length(kredyty_inp) * 100, 2)
tabela2 <- matrix(
  c(liczba_duplikatow, paste0(udzial_duplikatow, "%")),
  nrow = 1
)
colnames(tabela2) <- c("Liczba duplikatów","Udział duplikatów")

kable(tabela2, align = "c") %>%
  kable_styling(full_width = FALSE, position = "center") %>%
  row_spec(0, bold = TRUE, color = "navy")
```

# **Wizualizacja danych**

## Wykres kołowy

<p style="text-align: center;">[**Rozkład statusów decyzji kredytowych**]{style="color:navy;"}</p>

```{r, fig.align='center', fig.width=7, fig.height=5}
max_income <- 20000
max_loan_amount <- 300

filtered_data <- kredyty_inp %>%
    filter(ApplicantIncome <= max_income) %>%
    filter(LoanAmount <= max_loan_amount)

counts_summary <- filtered_data %>%
    count(Loan_Status)

kolowy <- data.frame(
  Loan_Status = c("N", "Y"),
  n = c(177, 401)
)

kolowy2 <- kolowy %>%
  mutate(
    total = sum(n),
    percentage = (n / total) * 100
  )

ggplot(kolowy2, aes(x = "", y = percentage, fill = Loan_Status)) +
  geom_bar(width = 1, stat = "identity", color = "white") +
  coord_polar("y", start = 0) + 
  scale_fill_manual(values = c("N" = "orchid", "Y" = "navy")) + 
  theme_void() + 
  labs(fill = "Status pożyczki") +
  geom_text(
    aes(label = paste0(round(percentage, 1), "%\n(", n, ")")),
    position = position_stack(vjust = 0.5),
    color = "lavender",
    size = 5
  ) +
  theme(
    legend.position = "right"
  )
```

<p style="text-align: justify;">Wykres pokazuje, że większość wniosków kredytowych zakończyła się pozytywną decyzją - około 69% stanowią zgody na udzielenie pożyczki. Odmowy stanowią natomiast około 31% wszystkich przypadków.</p>

## Wykresy słupkowe

<p style="text-align: center;">[**Udział decyzji kredytowych w zależności od obszaru zamieszkania**]{style="color:navy;"}</p>

```{r, fig.align='center', fig.width=7, fig.height=5}
ggplot(kredyty_inp, aes(x = Property_Area, fill = Loan_Status)) +
  geom_bar(position = "fill") +
  scale_y_continuous(labels = scales::percent) +
  labs(
       x = "Obszar zamieszkania",
       y = "Udział (%)",
       fill = "Decyzja") +
  scale_fill_manual(values = c("N" = "lavender", "Y" = "navy")) +
  theme_minimal(base_size = 10)
```

<p style="text-align: justify;">Najwyższy odsetek wniosków zakończonych przyznaniem kredytu można zaobserwować wśród klientów mieszkających w obszarach półmiejskich. W tej grupie ponad 75% wniosków kończy się akceptacją. W obszarach miejskich i wiejskich udział decyzji pozytywnych jest niższy i wynosi około 60-65%.</p>

<p style="text-align: center;">[**Udział decyzji kredytowych w zależności od historii kredytowej**]{style="color:navy;"}</p>

```{r, fig.align='center', fig.width=7, fig.height=5}
ggplot(kredyty_inp, aes(x = as.factor(Credit_History), fill = Loan_Status)) +
  geom_bar(position = "fill") +
  scale_y_continuous(labels = scales::percent) +
  labs(
    x = "Historia kredytowa (0 = brak, 1 = dobra)",
    y = "Udział (%)",
    fill = "Decyzja"
  ) +
  scale_fill_manual(values = c("N" = "lavender", "Y" = "navy")) +
  theme_minimal(base_size = 10)
```

<p style="text-align: justify;">Wykres pokazuje, że wśród klientów posiadających historię kredytową znaczna większość otrzymuje kredyt, natomiast jej brak wiąże się z dużo większym odsetkiem odrzuceń.</p>

<p style="text-align: center;">[**Udział decyzji kredytowych w zależności od poziomu wykształcenia**]{style="color:navy;"}</p>

```{r, fig.align='center', fig.width=7, fig.height=5}
ggplot(kredyty_inp, aes(x = as.factor(Education), fill = Loan_Status)) +
  geom_bar(position = "fill") +
  scale_y_continuous(labels = scales::percent) +
  labs(
    x = "Poziom wykształcenia",
    y = "Udział (%)",
    fill = "Decyzja"
  ) +
  scale_fill_manual(values = c("N" = "lavender", "Y" = "navy")) +
  theme_minimal(base_size = 10) +
  theme(plot.title = element_text(hjust = 0.5))
```

<p style="text-align: justify;">Z wykresu wynika, że osoby z wykształceniem częściej otrzymują zgodę na udzielenie kredytu niż osoby bez wykształcenia. Jednocześnie w grupie bez wykształcenia odsetek odmów jest wyraźnie większy.</p>

## Wykresy pudełkowe

```{r, fig.align='center', fig.width=7, fig.height=8}
p1 <- ggplot(kredyty_inp, aes(x = Education, y = LoanAmount)) +
  geom_boxplot(color = "navy") +
  labs(
    x = "Poziom wykształcenia",
    y = "Kwota pożyczki [tys. USD]"
  ) +
  stat_summary(
               fun = mean,
               geom = "point",
               aes(group = 1),
               color = "orchid",
               size = 3) +
  theme(plot.margin = margin(5,5,5,5)) +
  theme_minimal()

p2 <- ggplot(kredyty_inp, aes(x = Gender, y = LoanAmount)) +
  geom_boxplot(color = "navy") +
  labs(
    x = "Płeć",
    y = "Kwota pożyczki [tys. USD]"
  ) +
  stat_summary(
               fun = mean,
               geom = "point",
               aes(group = 1),
               color = "orchid",
               size = 3) +
  theme(plot.margin = margin(5,5,5,5)) +
  theme_minimal()

p3 <- ggplot(kredyty_inp, aes(x = as.factor(Credit_History), y = LoanAmount)) +
  geom_boxplot(color = "navy") +
  labs(
    x = "Historia kredytowa (0 = brak, 1 = dobra)",
    y = "Kwota pożyczki [tys. USD]"
  ) +
  stat_summary(
               fun = mean,
               geom = "point",
               aes(group = 1),
               color = "orchid",
               size = 3) +
  theme(plot.margin = margin(20,5,5,5)) +
  theme_minimal()

p4 <- ggplot(kredyty_inp, aes(x = Property_Area, y = LoanAmount)) +
  geom_boxplot(color = "navy") +
  labs(
    x = "Obszar zamieszkania",
    y = "Kwota pożyczki [tys. USD]"
  ) +
  stat_summary(
               fun = mean,
               geom = "point",
               aes(group = 1),
               color = "orchid",
               size = 3) +
  theme(plot.margin = margin(20,5,5,5)) +
  theme_minimal()

p5 <- ggplot(kredyty_inp, aes(x = Dependents, y = LoanAmount)) +
  geom_boxplot(color = "navy") +
  labs(
    x = "Liczba osób w gospodarstwie",
    y = "Kwota pożyczki [tys. USD]"
  ) +
  stat_summary(
               fun = mean,
               geom = "point",
               aes(group = 1),
               color = "orchid",
               size = 3) +
  theme(plot.margin = margin(20,5,5,5)) +
  theme_minimal()

p6 <- ggplot(kredyty_inp, aes(x = Married, y = LoanAmount)) +
  geom_boxplot(color = "navy") +
  labs(
    x = "Związek małżeński",
    y = "Kwota pożyczki [tys. USD]"
  ) +
  stat_summary(
               fun = mean,
               geom = "point",
               aes(group = 1),
               color = "orchid",
               size = 3) +
  theme(plot.margin = margin(20,5,5,5)) +
  theme_minimal()

(p1 + p2) /
(p3 + p4) /
(p5 + p6) +
  plot_layout(heights = c(1, 1, 1))

```

<p style="text-align: justify;">Wykresy pokazują, że istnieją różnice w kwocie kredytów w zależności od poziomu wykształcenia, płci, liczby osób w gospodarstwie domowym oraz stanu cywilnego. Nie widać natomiast istotnych różnic dla historii kredytowej oraz obszaru zamieszkania.</p>

## Heatmapa

<p style="text-align: center;">[**Korelacja zmiennych numerycznych**]{style="color:navy;"}</p>

```{r, fig.align='center', fig.width=7, fig.height=5}
macierz_korelacji <- round(cor(kredyty_inp %>% select_if(is.numeric)), 2)
macierz_korelacji <- reshape2::melt(macierz_korelacji)

nazwy <- c(
  ApplicantIncome = "Dochód wnioskodawcy",
  CoapplicantIncome = "Dochód współwnioskodawcy",
  LoanAmount = "Kwota pożyczki",
  Loan_Amount_Term = "Okres pożyczki",
  Credit_History = "Historia kredytowa"
)

ggplot(data = macierz_korelacji, aes(x = Var1, y = Var2, fill = value)) +
    geom_tile(color = "white") +
    scale_fill_gradient2(
        low = "orchid",
        high = "navy",
        mid = "lavender",
        midpoint = 0,
        limit = c(-1, 1),
        space = "Lab",
        name = "Korelacja"
    ) +
    theme_minimal() +
    coord_fixed() +
    geom_text(aes(Var1, Var2, label = round(value, 2)), color = "black", size = 4) +
    labs(
        x = "",
        y = ""
    ) +
    scale_x_discrete(labels = nazwy) +
    scale_y_discrete(labels = nazwy) +
    theme(
        axis.text.x = element_text(angle = 90, vjust = 1, size = 10, hjust = 1),
        axis.text.y = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)
    )

```

<p style="text-align: justify;">Wykres korelacji pokazuje, że najsilniejsza zależność występuje między dochodem wnioskodawcy a kwotą pożyczki (umiarkowana dodatnia korelacja). Pozostałe zmienne, w tym historia kredytowa i okres pożyczki, są ze sobą bardzo słabo skorelowane lub praktycznie niezależne.</p>

## Wykres punktowy

<p style="text-align: center;">[**Zależność między dochodem wnioskodawcy a kwotą pożyczki**]{style="color:navy;"}</p>

```{r, fig.align='center', fig.width=7, fig.height=5}
filtered_data <- kredyty_inp %>%
    mutate(Income = (ApplicantIncome + CoapplicantIncome)/1000)
ggplot(data = filtered_data, aes(x = Income, y = LoanAmount, color = Loan_Status)) +
    geom_point(alpha = 0.7, size = 3) + 
    labs(
        x = "Dochód gospodarstwa domowego [tys. USD]",
        y = "Kwota pożyczki [tys. USD]",
        color = "Status pożyczki"
    ) +
    scale_color_manual(values = c("N" = "orchid", "Y" = "navy")) +
    theme_minimal() +
    theme(plot.title = element_text(hjust = 0.5))

```

<p style="text-align: justify;">Zdecydowana większość wniosków kredytowych koncentruje się w obszarze niskich dochodów - poniżej 20 000 USD oraz niskich kwot pożyczek, czyli tych o kwotach poniżej 300 tys. USD. Powyższy wykres wskazuje zatem, że dochód i kwota pożyczki nie są jedynymi czynnikami decyzyjnymi, ponieważ w określonym obszarze występują zarówno wnioski przyjęte, jak i odrzucone.</p>

# **Analiza opisowa**

## Miary położenia i zróżnicowania zmiennych ilościowych 

```{r}
zmienne <- kredyty_inp[, c("ApplicantIncome",
                           "CoapplicantIncome",
                           "LoanAmount",
                           "Loan_Amount_Term")]

statystyki_opisowe <- t(sapply(zmienne, function(x) {
  c(
    Średnia = mean(x),
    Mediana = median(x),
    Minimum = min(x),
    Maksimum = max(x),
    Rozstęp = max(x, na.rm = TRUE) - min(x, na.rm = TRUE)
  )
}))

statystyki_opisowe <- as.data.frame(statystyki_opisowe)

rownames(statystyki_opisowe) <- c(
  "Applicant Income",
  "Coapplicant Income",
  "Loan Amount",
  "Loan Amount Term"
)

kable(statystyki_opisowe, digits = 2, align = "c") %>%
  kable_styling(full_width = TRUE, position = "center") %>%
   row_spec(0, bold = TRUE, color = "navy")

```

```{r}
statystyki_opisowe2 <- t(sapply(zmienne, function(x) {
  c(
    `Rozstęp międzykwartylowy` = IQR(x, na.rm = TRUE),
    Wariancja = var(x, na.rm = TRUE),
    `Odchylenie standardowe` = sd(x),
    `Współczynnik zmienności (%)` = sd(x) / mean(x) * 100
  )
}))

statystyki_opisowe2 <- as.data.frame(statystyki_opisowe2)

rownames(statystyki_opisowe2) <- c(
  "Applicant Income",
  "Coapplicant Income",
  "Loan Amount",
  "Loan Amount Term"
)

kable(statystyki_opisowe2, digits = 2, align = "c") %>%
  kable_styling(full_width = TRUE, position = "center") %>%
   row_spec(0, bold = TRUE, color = "navy")
```


<p style="text-align: justify;">Analiza statystyk opisowych wskazuje na duże zróżnicowanie dochodów wśród wnioskodawców. Ich średni dochód wynosi około 5403 USD. Mediana natomiast kształtuje się na poziomie 3813 USD. Różnica pomiędzy średnią a medianą może sugerować prawostronną asymetrię rozkładu dochodów. Oznacza to, że część obserwacji o bardzo wysokich dochodach zawyża wartość średnią. Minimalny dochód wynosi 150 USD, a maksymalny aż 81000 USD. To również potwierdza dużą rozpiętość danych.</p>

<p style="text-align: justify;">Dochody współwnioskodawców są przeciętnie znacznie niższe. Ich średnia wynosi około 1621 USD, a mediana 1189 USD. Wysokie odchylenie standardowe również pokazuje duże zróżnicowanie tej zmiennej.</p>

<p style="text-align: justify;">Średnia kwota pożyczki wynosi około 146 tys. USD, przy medianie równej 128 tys. USD. Podobnie jak w przypadku dochodów, wyższa wartość średniej w porównaniu do mediany pokazuje asymetrię rozkładu i obecność relatywnie wysokich kwot kredytów. Zakres zmienności jest znaczny, bo od od 9 do 700 tys. USD. Badana próba obejmuje więc zarówno niewielkie, jak i bardzo wysokie zobowiązania kredytowe.</p>

<p style="text-align: justify;">Okres kredytowania ma mniejsze zróżnicowanie w porównaniu do pozostałych zmiennych. Średni okres spłaty wynosi około 342 miesiące, a mediana równa jest 360 miesiącom, więc najczęściej spotykanym okresem kredytowania jest 30 lat. Odchylenie standardowe na poziomie 65 miesięcy świadczy o umiarkowanej zmienności tej zmiennej, a zakres od 12 do 480 miesięcy wskazuje na istnienie zarówno krótkoterminowych, jak i długoterminowych umów kredytowych.</p>

<p style="text-align: justify;">Dla dochodu wnioskodawcy rozstęp wynosi 80 850, a wariancja 37 320 390,17. Jest to bardzo szeroki zakres obserwowanych wartości oraz występują pomiędzy nimi znaczne różnice. Jednocześnie wysoki rozstęp międzykwartylowy (2 917,50) sugeruje, że nawet w centralnej części rozkładu zmienność dochodów jest duża. Podobnie, ale w mniejszym stopniu, zróżnicowany jest dochód współwnioskodawcy, dla którego rozstęp wynosi 41 667, a wariancja 8 562 929,52. Wartość rozstępu międzykwartylowego (2 297,25) pokazuje istotne zróżnicowanie dochodów wśród środkowych 50% obserwacji. W przypadku kwoty kredytu rozstęp wynosi 691, a rozstęp międzykwartylowy 68. Połowa obserwacji mieści się w wąskim przedziale wartości, mimo występowania obserwacji skrajnych, które zwiększają całkowity rozstęp i wariancję. Okres spłaty kredytu ma rozstęp równy 468, jednak rozstęp międzykwartylowy wynosi 0, co oznacza, że co najmniej 50% kredytów posiada identyczny okres spłaty (najczęściej 360 miesięcy). Wskazuje to na silną koncentrację obserwacji wokół jednej wartości oraz niewielkie zróżnicowanie w centralnej części rozkładu, mimo obecności wartości skrajnych.</p>

<p style="text-align: justify;">Współczynnik zmienności pokazuje bardzo duże zróżnicowanie dochodów w badanej próbie. Najwyższą zmienność ma dochód współwnioskodawcy (180,49%), co świadczy o silnej heterogeniczności tej zmiennej. Dochód głównego wnioskodawcy także cechuje się bardzo wysokim współczynnikiem zmienności (113,06%). Kwota kredytu wykazuje umiarkowane zróżnicowanie (58,99%), natomiast najmniejszą zmienność ma okres kredytowania (18,93%).</p>

## Miary asymetrii i kurtozy

```{r}
zmienne <- kredyty_inp[, c("ApplicantIncome",
                           "CoapplicantIncome",
                           "LoanAmount",
                           "Loan_Amount_Term")]

asymetria_kurtoza <- t(sapply(zmienne, function(x) {
  c(
    Asymetria = skewness(x),
    Kurtoza = kurtosis(x)
  )
}))

asymetria_kurtoza <- as.data.frame(asymetria_kurtoza)

rownames(asymetria_kurtoza) <- c(
  "Applicant Income",
  "Coapplicant Income",
  "Loan Amount",
  "Loan Amount Term"
)

kable(asymetria_kurtoza, digits = 2, align = "c") %>%
  kable_styling(full_width = FALSE, position = "center") %>%
  row_spec(0, bold = TRUE, color = "navy")
```

<p style="text-align: justify;">Współczynnik asymetrii dla dochodów wnioskodawców wynosi 6,51, co potwierdza silną asymetrię prawostronną rozkładu, opisywaną już w miarach położenia i zróżnicowania zmiennych ilościowych. Większość obserwacji skupiona jest na niskich wartościach dochodu, natomiast występują nieliczne, lecz bardzo wysokie dochody, które wydłużają prawy ogon rozkładu. Kurtoza na poziomie 59,83 świadczy o rozkładzie leptokurtycznym, charakteryzującym się obecnością obserwacji odstających.</p>

<p style="text-align: justify;">Zmienna dochody współwnioskodawców ma asymetrię prawostronną o wartości 7,45, jeszcze silniejszą niż w przypadku dochodu głównego wnioskodawcy. Oznacza to, że zdecydowana większość współwnioskodawców osiąga niskie lub zerowe dochody, natomiast niewielka liczba obserwacji przyjmuje bardzo wysokie wartości. Kurtoza równa 83,97 potwierdza silną koncentrację danych wokół niskich wartości oraz obecność bardzo silnych obserwacji odstających.</p>

<p style="text-align: justify;">Dla kwoty pożyczki współczynnik asymetrii wynosi 2,63, co wskazuje na umiarkowaną asymetrię prawostronną. Rozkład kwot kredytu jest mniej skośny niż rozkłady dochodów, jednak nadal dominują niższe kwoty kredytów przy występowaniu większych wartości skrajnych. Kurtoza na poziomie 9,87 wskazuje na większą koncentrację obserwacji wokół wartości centralnych oraz obecność obserwacji odstających.</p>

<p style="text-align: justify;">Okres kredytowania charakteryzuje się asymetrią lewostronną (–2,35). Większość okresów kredytowania koncentruje się na dłuższych terminach, natomiast krótsze okresy występują rzadziej. Kurtoza równa 6,72 sugeruje koncentrację obserwacji wokół typowych długości okresów kredytowania oraz ograniczoną, lecz wyraźną liczbę wartości odstających.</p>

<p style="text-align: justify;">Wszystkie analizowane zmienne charakteryzują się znacznym odejściem od rozkładu normalnego, szczególnie w przypadku zmiennych dochodowych, które wykazują silną asymetrię prawostronną oraz bardzo wysoką kurtozę.</p>

## Analiza korelacji

```{r}
macierz_korelacji <- round(cor(zmienne, method = "pearson"), 2)

rownames(macierz_korelacji) <- c(
  "Applicant Income",
  "Coapplicant Income",
  "Loan Amount",
  "Loan Amount Term"
)

colnames(macierz_korelacji) <- c(
  "Applicant Income",
  "Coapplicant Income",
  "Loan Amount",
  "Loan Amount Term"
)

kable(
  macierz_korelacji,
  align = "c"
) %>%
  kable_styling(full_width = FALSE, position = "center") %>%
  row_spec(0, bold = TRUE, color = "navy")

```

<p style="text-align: justify;">**Klasyfikacja siły korelacji**:</p> 

<p style="text-align: justify;">|r| < 0,3 - słaba korelacja</p>

<p style="text-align: justify;">0,3 ≤ |r| ≤ 0,7 - umiarkowana korelacja</p>

<p style="text-align: justify;">|r| ≥ 0,7 - silna korelacja</p>

<p style="text-align: justify;">Na podstawie przeprowadzonej analizy korelacji Pearsona można stwierdzić, że zależności pomiędzy analizowanymi zmiennymi ilościowymi są zróżnicowane pod względem siły i kierunku. Najsilniejszą zależność zaobserwowano pomiędzy dochodem wnioskodawcy a kwotą kredytu, dla której współczynnik korelacji wynosi 0,55. Wskazuje to na umiarkowaną dodatnią korelację: wraz ze wzrostem dochodu głównego wnioskodawcy rośnie przeciętnie kwota zaciąganego kredytu. Zależność pomiędzy dochodem współwnioskodawcy a kwotą kredytu jest słaba i dodatnia: r = 0,18. Dochód współwnioskodawcy ma mniejsze znaczenie przy ustalaniu wysokości kredytu niż dochód głównego wnioskodawcy. Korelacje pomiędzy dochodami wnioskodawców a okresem spłaty kredytu są bardzo słabe i bliskie zeru, od –0,06 do 0,03. Brak jest więc istotnej zależności liniowej pomiędzy tymi zmiennymi. Ponadto, korelacja pomiędzy dochodem wnioskodawcy a dochodem współwnioskodawcy jest słaba i ujemna: r = –0,12. Zmienne te nie wykazują istotnej współzależności.</p>

# **Testy statystyczne**
```{r include=FALSE}
install.packages("ggstatsplot")
library(ggstatsplot)

```

```{r}
#badanie rozkładu zmiennych
shapiro_applicant <- shapiro.test(dane$ApplicantIncome)
shapiro_loanamount <- shapiro.test(dane$LoanAmount)
shapiro_applicant
shapiro_loanamount
```
Test Shapiro pokazał, że zarówno zmienna ApplicantIncome (dochód wnioskodawcy), jak i zmienna LoanAmount (kwota kredytu) nie mają rozkładu normalnego. Dla obu testów p-value było mniejsze od 0,5, więc należy odrzucić hipotezę zerową o normalności rozkładu.
